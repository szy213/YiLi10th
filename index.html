<!DOCTYPE html>
<html lang="zh-CN">
<head>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸€ç²’å·¡æ¼”å…¨çºªå½•</title>
    <style>
        :root {
            --tag-bg: #B8860B;      
            --tag-guest: #525A6B;   
            --tag-special:#8C2222;
            --paper-white: rgba(255, 255, 255, 0.5); 
            --seal-red: #8C2222; 
        }

        /* --- æ ·å¼éƒ¨åˆ†ä¿æŒä¸å˜ --- */
        * { box-sizing: border-box; }
        body {
            margin: 0; padding: 0;
            background-image: linear-gradient(to bottom, rgba(255,255,255,0.7) 0%, rgba(255,255,255,0.2) 25%, transparent 40%), url('images/033de8f0d6622db97e42ea88b4770bba.jpg');
            background-size: 100% auto; background-repeat: no-repeat; background-attachment: scroll; background-position: top center; background-color: #f2f2f2;
            font-family: "STSong", "SimSun", serif; color: #333; line-height: 1.6;
            transition: background-image 0.8s ease-in-out;
        }
        .header { text-align: center; padding: 120px 20px 60px; }
        .header h1 { letter-spacing: 25px; font-size: 4.5em; margin: 0; color: #262626; margin-right: -25px; }
        .header p { font-size: 1.5em; letter-spacing: 5px; margin-top: 20px; color: #4a4a4a; font-weight: bold; }
        .tour-grid { position: relative; max-width: 900px; margin: 0 auto; display: flex; flex-direction: column; gap: 160px; padding: 60px 20px 400px; }
      .tour-card {
    position: relative;
    background: var(--paper-white);
    backdrop-filter: blur(5px);
    padding: 35px;
    border-left: 2px solid var(--tag-guest);
    z-index: 10;
    
    /* æ ¸å¿ƒï¼šæ·»åŠ è¿‡æ¸¡åŠ¨ç”»ï¼Œè®©æ•ˆæœå¹³æ»‘ */
    transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
    box-shadow: 0 5px 15px rgba(0,0,0,0.05); /* åˆå§‹å¾®å¼±é˜´å½± */
}

/* 2. å®šä¹‰é¼ æ ‡ç§»ä¸Šå»ï¼ˆhoverï¼‰æ—¶çš„å‘¼å¸æ”¾å¤§æ•ˆæœ */
.tour-card:hover {
    /* ç¨å¾®æ”¾å¤§å¡ç‰‡ */
    transform: translateY(-5px) scale(1.02); 
    
    /* å¢åŠ é˜´å½±æ·±åº¦ï¼Œæ¨¡æ‹ŸæŠ¬å‡æ„Ÿ */
    box-shadow: 0 15px 30px rgba(0,0,0,0.15);
    
    /* å¯é€‰ï¼šæ”¹å˜èƒŒæ™¯é€æ˜åº¦è®©å‘¼å¸æ„Ÿæ›´å¼º */
    background: rgba(255, 255, 255, 0.8);
    
    /* ç¡®ä¿æ‚¬åœæ—¶å±‚çº§æœ€é«˜ï¼Œä¸è¢«æœå®é®æŒ¡ */
    z-index: 11;
}

/* å®šä¹‰å‹‹ç« å‘å…‰å‘¼å¸åŠ¨ç”» */
@keyframes badgeGlow {
    0% { 
        box-shadow: 0 0 5px rgba(218, 165, 32, 0.2); 
        transform: scale(1);
    }
    50% { 
        box-shadow: 0 0 20px rgba(218, 165, 32, 0.6), 0 0 30px rgba(184, 134, 11, 0.3); 
        transform: scale(1.05); /* å¾®å¾®æ”¾å¤§ */
    }
    100% { 
        box-shadow: 0 0 5px rgba(218, 165, 32, 0.2); 
        transform: scale(1);
    }
}

/* ç‚¹äº®å‹‹ç« çš„ç±»å */
.badge-unlocked {
    animation: badgeGlow 3s infinite ease-in-out;
    border-color: #DAA520!important;
    background: #fff !important;
}

        .tour-info { display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 25px; border-bottom: 1px solid rgba(0,0,0,0.08); padding-bottom: 12px; }
        .city-name { color: #4a4a4a; font-size: 2em; font-weight: bold; margin-right: 15px; cursor: pointer; }
        .date-num { color:#4a4a4a ; font-size: 1.5em; font-family: "Times New Roman", serif; }
        .tour-guest { font-size:1em; color: #666; letter-spacing: 1px; cursor: pointer; text-decoration: underline dotted; }
        .special-songs-box { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px; }
        .song-tag { padding: 5px 15px; font-size: 12px; border: 1px solid currentColor; letter-spacing: 1px; }
        .song-tag.guest { color: var(--tag-guest); }
        .song-tag.request { color: var(--tag-bg); }
        .song-tag.surprise { color: var(--tag-special); }
        .check-area { font-size: 0.8em; color: #999; text-align: right; font-style: italic; }
        .image-slider { display: flex; overflow-x: auto; scroll-snap-type: x mandatory; gap: 15px; margin: 15px 0 25px 0; padding-bottom: 10px; }
        .image-slider::-webkit-scrollbar { height: 4px; }
        .image-slider::-webkit-scrollbar-thumb { background: var(--tag-guest); border-radius: 10px; }
        
        .slider-img { 
            flex: 0 0 auto; height: 300px; border-radius: 4px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); 
            opacity: 0; transition: opacity 0.5s ease-in-out;
        }
        .slider-img[src] { opacity: 1; }
/* ä¿®æ”¹ç¬¬ 103 è¡Œèµ·çš„å¼¹çª—æ ·å¼ */
#quoteModal { 
    display: none; 
    position: fixed; /* é”å®šåœ¨å±å¹•è§†é‡ï¼Œä¸éšæ»šåŠ¨æ¡èµ° */
    top: 0; left: 0; 
    width: 100vw; height: 100vh; 
    background: rgba(0, 0, 0, 0.6); 
    z-index: 9999; 
    
    /* æ ¸å¿ƒï¼šçœŸæ­£çš„è§†é‡å‚ç›´å±…ä¸­ */
    justify-content: center; 
    align-items: center; 
    opacity: 0;
    transition: opacity 0.3s ease;
}

/* æ¿€æ´»çŠ¶æ€ */
#quoteModal.active { display: flex; opacity: 1; }

/* æ›¿æ¢ .modal-content ä¸ºåŠ¨æ€ä¿¡å°æ ·å¼ */
.modal-content { 
    background: #fdfdfd;
    padding: 45px 35px; 
    width: 90%;
    max-width: 420px; 
    border-radius: 2px;
    box-shadow: 0 20px 50px rgba(0,0,0,0.3);
    position: relative;
    
    /* ä¿¡å°å¼¹å‡ºåŠ¨ç”»ï¼šå‘ä¸‹åç§»å¹¶ç¼©å° */
    transform: translateY(40px) scale(0.9);
    transition: transform 0.4s cubic-bezier(0.165, 0.84, 0.44, 1);
    
    /* ä¿¡çº¸è´¨æ„Ÿ */
    background-image: linear-gradient(to bottom, #fff 0%, #f9f9f9 100%);

    background-image: repeating-linear-gradient(
        transparent 0px, 
        transparent 31px, 
        #ececec 32px
    );
    background-size: 100% 32px;
    padding-top: 60px; /* è°ƒæ•´é¡¶éƒ¨é—´è·ï¼Œé¿å¼€ç«æ¼†å° */
}

/* æ¿€æ´»æ—¶é£å…¥æ­£ä¸­å¿ƒ */
#quoteModal.active .modal-content {
    transform: translateY(0) scale(1);
}

/* è£…é¥°ï¼šçº¢è‰²ç«æ¼†å°æ•ˆæœ */
.modal-content::before {
    content: "ğŸ’";
    position: absolute;
    top: -20px; left: 50%;
    transform: translateX(-50%);
    width: 40px; height: 40px;
    background: var(--tag-special);
    border-radius: 50%;
    display: flex; justify-content: center; align-items: center;
    font-size: 20px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
}

.modal-text { 
    display: block; 
    margin: 20px 0 30px; 
    color: #444; 
    line-height: 1.8; 
    text-align: left;
    font-size: 1.1em;
}
        .close-btn { background: var(--tag-guest); color: #fff; border: none; padding: 12px; cursor: pointer; width: 100%; }
        
        .music-wrapper { position: fixed; bottom: 30px; right: 30px; display: flex; align-items: center; gap: 10px; z-index: 1000; }
        #bgmSelector { background: var(--paper-white); backdrop-filter: blur(10px); border: 1px solid var(--tag-guest); padding: 5px; border-radius: 5px; font-family: inherit; font-size: 12px; cursor: pointer; opacity: 0; transition: opacity 0.3s; }
        .music-wrapper:hover #bgmSelector { opacity: 1; }
        #musicControl { width: 45px; height: 45px; background: var(--paper-white); border: 1px solid var(--tag-guest); border-radius: 50%; display: flex; justify-content: center; align-items: center; cursor: pointer; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .rotating { animation: rotate 3s linear infinite; }
        @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        .special-badge {
            position: absolute; top: -10px; right: 25px; padding: 10px 6px; background-color: var(--seal-red); color: white; font-size: 13px; font-weight: bold; writing-mode: vertical-rl; letter-spacing: 2px; z-index: 11; box-shadow: 2px 2px 5px rgba(0,0,0,0.15);
        }
        .special-badge::after {
            content: ''; position: absolute; bottom: -8px; left: 0; border-width: 4px 14px; border-style: solid; border-color: var(--seal-red) var(--seal-red) transparent var(--seal-red);
        }

        .part-selector { text-align: center; margin-bottom: 40px; display: flex; justify-content: center; gap: 30px; }
        .part-btn { font-family: "STSong", "SimSun", serif; font-size: 2em; background: none; border: none; border-bottom: 2px solid transparent; color: #666; cursor: pointer; padding: 5px 15px; transition: all 0.3s; letter-spacing: 4px; }
        .part-btn.active { color: var(--tag-guest); border-bottom: 2px solid var(--tag-guest); font-weight: bold; }
        .tour-card.unplayed { opacity: 0.8; filter: grayscale(0.8); }
        .unplayed-label { color: var(--tag-bg); font-size: 0.8em; margin-left: 10px; }

  .shiguan-egg {
    position: absolute; 
    width: 100px;
    height: 100px;
    cursor: pointer;
    z-index: 100;
    
    /* åˆå§‹é€æ˜åº¦è®¾ä¸º0ï¼Œé…åˆåŠ¨ç”»å®ç°æ·¡å…¥ */
    opacity: 0; 
    transition: opacity 1s ease-in-out, transform 0.4s ease;
    
    animation: eggFloat 4s ease-in-out infinite, fadeInEgg 1s forwards;
}

/* æ–°å¢ï¼šæ·¡å…¥åŠ¨ç”» */
@keyframes fadeInEgg {
    from { opacity: 0; }
    to { opacity: 0.8; } /* æœ€ç»ˆé€æ˜åº¦ä¸ä½ è®¾å®šçš„ä¿æŒä¸€è‡´ */
}

@keyframes eggFloat {
    0%, 100% { transform: translateY(0) rotate(0deg); }
    50% { transform: translateY(-20px) rotate(5deg); }
}


/* æ‚¬åœå¢å¼ºæ•ˆæœ */
.shiguan-egg:hover {
    opacity: 1;
    transform: scale(1.2);
}   

/* ç¥¨æ ¹å¡ç‰‡çš„åŸºç¡€æ ·å¼ */
.ticket-card {
    background: #fff !important;
    border: none !important;
    position: relative;
    padding: 40px 25px !important;
    box-shadow: 0 10px 25px rgba(0,0,0,0.1);
}

/* æ¨¡æ‹Ÿå·¦å³ä¸¤ä¾§çš„æ’•å£åœ†æ´ */
.ticket-card::before, .ticket-card::after {
    content: '';
    position: absolute;
    top: 50%;
    width: 24px;
    height: 24px;
    background: #f2f2f2; /* è¿™é‡Œçš„é¢œè‰²è¦å’ŒèƒŒæ™¯èƒŒæ™¯è‰²ä¸€è‡´ */
    border-radius: 50%;
    transform: translateY(-50%);
    z-index: 5;
}
.ticket-card::before { left: -12px; }
.ticket-card::after { right: -12px; }

/* è£…é¥°çº¢å°ç«  */
.seal-stamp {
    position: absolute;
    bottom: 20px;
    right: 20px;
    width: 60px;
    height: 60px;
    border: 2px solid var(--seal-red);
    border-radius: 50%;
    color: var(--seal-red);
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 10px;
    transform: rotate(-15deg);
    opacity: 0.6;
    border-style: double;
    pointer-events: none;
}



</style>
</head>
<body>

<div class="header">
    <h1>ä¸€ç²’ Â· å·¡æ¼”å…¨çºªå½•</h1>
    <p> é™ªç€å¦³ çˆ±ç€å¦³ å¸¸å¸¸æƒ³èµ·å¦³ </p>
</div>

<div class="part-selector">
    <button class="part-btn active" onclick="changePart(1, this)">PART I</button>
    <button class="part-btn" onclick="changePart(2, this)">PART II</button>
    <button class="part-btn" onclick="changePart(3, this)">æˆ‘çš„ä¸€ç²’</button>
</div>

<div class="tour-grid" id="mainGrid"></div>

<div class="music-wrapper">
    <select id="bgmSelector" onchange="changeBGM(this.value)">
        <option value="bgm.mp3">æœå®</option>
        <option value="bgm2.mp3">ä¸ç­</option>
        <option value="bgm3.mp3">ä»»æœæš®</option>
        <option value="bgm4.mp3">ç•™ä¸‹</option>
    </select>
    <div id="musicControl" onclick="toggleMusic()">
        <span id="musicIcon">ğŸµ</span>
    </div>
</div>

<audio id="bgMusic" loop><source id="musicSource" src="bgm.mp3" type="audio/mpeg"></audio>

<div id="quoteModal" onclick="closeModal()">
    <div class="modal-content" onclick="event.stopPropagation()">
        <div style="text-align:center; font-weight:bold; color:var(--tag-special); margin-bottom:15px; letter-spacing:2px; border-bottom:1px dashed #ddd; padding-bottom:10px;">
            æ¥è‡ªå°é™ˆçš„ç§ä¿¡
        </div>
        <span class="modal-text" id="modalText"></span>
        <button class="close-btn" onclick="closeModal()">æ”¶ä¸‹äº†</button>
    </div>
</div>

<script>
    // 1. æ•°æ®å®šä¹‰ (æ”¾åœ¨æœ€å‰é¢ï¼Œç¡®ä¿å‡½æ•°èƒ½è®¿é—®åˆ°)
    const quotes = {
        "0726": "0:00ï¼Œåˆé•¿å¤§äº†ä¸€å²\nè°¢è°¢ä½ ä»¬é™ªç€æˆ‘ï¼Œçˆ±ç€æˆ‘ï¼Œå¸¸å¸¸æƒ³èµ·ï¼šæˆ‘ä¹Ÿè®°å¾—ä½ åœ¨å¿ƒé‡Œæ’‘èµ·å¥½å¤šè‰°éš¾æ—¶åˆ»(éšè—æ–­å¥)\nğŸ’— \nè°¢è°¢ä½ æ¥.",
        "0727": "æ˜¯... \næœå¤•ç›¸ä¼´è§¦æ‰‹å¯åŠçš„äº²æ˜µğŸ \nâ¤ï¸â¤ï¸â¤ï¸â¤ï¸â¤ï¸â¤ï¸\n love u allâ¤ï¸ï¼",
        "0808": "å›åˆ°ä¸Šæµ·ï¼Œæ›¾ç»åœ¨è¿™é‡Œ ï¼Œ\næœªæ»¡è¶³çš„å¹»æƒ³å’ŒæœŸç›¼\næ±‚è€Œä¸å¾—çš„æœªçŸ¥å’Œè¿·å¹»\nå¸Œæœ›ä»Šå¤©èƒ½å¸®ä½ çŸ­æš‚åœ°å¡«æ»¡\nå¸Œæœ›ä½ æ»¡è½½è€Œå½’ï¼Œ\nè€Œæˆ‘ä¹Ÿç†Ÿè®°äº†ï¼šæ±‚è€Œä¸å¾—æœªå¿…æ˜¯é—æ†¾ã€‚\nğŸˆ2025.8.8",
        "0809": "I, love, Shanghai.",
        "0920": "é¦™é¦™çš„ä¸€æ•´å¤œğŸ«§ \n ä¸€èµ·ï¼Œ \nåœ¨è¿™åŸå¸‚æ¸¸æˆğŸ’•  \nç¡å§æ­å·ğŸ’¤ \n æˆ‘ä¼šè®°å¾—ä»Šå¤©", 
        "0921": "ä»æœªæƒ³è¿‡èƒ½åœ¨æˆ‘è‡ªå·±çš„æ¼”å”±ä¼šä¸Šï¼Œä¸å¾ªç¯äº†æ— æ•°éçš„å£°éŸ³åŒå°ï¼Œå¼€æ¼”å”±ä¼šçœŸå¥½ï¼Œè°¢è°¢å¤§å®¶ï¼Œè°¢è°¢Karenï¼Œè°¢è°¢è¿™ä¸ªç¾å¥½çš„æ™šä¸Šï¼Œå¹¸ç¦æ™•å•¦ï¼",
        "1018": "äººæ½®ï¼Œå‘¼å¸ï¼Œå£°æµªï¼Œå…±æŒ¯ \néŸ³ä¹å¡«æ»¡äº†æˆ‘ä»¬ \næˆ‘ä»¬å¡«æ»¡äº†å¤œæ™š \nç¥ä½ å¿«ä¹ï¼Œå……æ»¡å‹‡æ°”ã€‚ \nğŸˆ \n è°¢è°¢å—äº¬ï¼",
        "1101": "ä»å—èµ°åˆ°åŒ—ï¼Œ \né€”å¾„è¿å¾™çš„é£é¸Ÿã€ç¿©è·¹çš„è½å¶ã€ç–¾é©°çš„åˆ—è½¦ï¼Œ \nåˆ†åˆ«ä»¥å„è‡ªçš„æ–¹å¼å¯»æ‰¾æŸç§é€‚å®œã€‚ \nè°¢è°¢è¥¿å®‰ï¼Œ \næ„¿ä½ ä¹˜å…´è€Œæ¥ï¼Œæ»¡è½½è€Œå½’ã€‚", 
        "1108": "æ¥å»åŒ†åŒ†ä¹‹é—´ï¼Œ \næˆ‘ä»¬æ¬£äºæ‰€é‡ã€‚ \nè™½ç„¶ä¼¸æ‰‹æŠ“ä¸ä½ä¸€é˜µé£ï¼Œ \nä½†è¢«é£æ‰¬èµ·çš„å¿«ä¹å´æ€»æ˜¯é²œæ´»ã€‚ \nè°¢è°¢æµå—ï¼Œ \næ‘Šå¼€æ‰‹æŒï¼Œå¸¦èµ°å¿«ä¹å›å¿†~", 
        "1115": "è®©å†…å¿ƒé©¯åŒ–çš„ç§©åºå¶å°”å¤±æ§ï¼Œ \nå…è®¸è‡ªå·±å è½åœ¨éŸ³ä¹é‡Œã€‚ \næŸ”è½¯çš„ç¾½æ¯›ï¼Œ \nå®‰å…¨ã€æ€¡äººã€ä¸°ç›ˆã€‚",
        "1129": "è°¢è°¢å¦é—¨ğŸŒŠ  \nç›¸æ‹¥çŸ­æš‚ï¼Œä½†éŸ³ä¹æ°¸è¿œæ¸©æŸ”æ•å¼€ã€‚",
        "1206": "æ—¥å…‰æ™’é€äº†æµ·å²¸ï¼Œ \næ´‹æµè¿˜åœ¨ä¸é£å‘¨æ—‹ã€‚ \næˆ‘ä»¬æ˜¯å¤œåŠä¸çœ çš„äººï¼Œ \nå¬éŸ³ä¹è€³è¯­ ï¼Œ \né™ªè§ç«çœ¨çœ¼ã€‚ \nè°¢è°¢æ·±åœ³ï¼Œæˆ‘ä»¬æ˜å¤©è§~",
        "1207": "å±ä½å‘¼å¸ï¼Œ \né—­ä¸Šçœ¼ç›ï¼Œ \nè®©éŸ³ä¹åƒè‡ªç”±è½ä½“ï¼Œ \nåœ¨æ—·é‡ï¼Œåœ¨äººç¾¤ï¼Œåœ¨å¿ƒé‡Œã€‚ \nè°¢è°¢æ·±åœ³,å†¬æ—¥æ¸©æš–çš„èµ äºˆã€‚", 
        "1220": "å››å­£æµè½¬ï¼Œ \né£å¹ã€äº‘åŠ¨ã€ä¸€å¤„è‰é‡ã€‚ \næ—¶åºæ›´è¿­ï¼Œå¤œé•¿ã€æ˜¼çŸ­ã€å‡ é¦–éŸ³ä¹ã€‚ \nè°¢è°¢è‹å·ï¼Œé•¿å¤œå¥½æ¢¦ã€‚", 
        "1231": "ç¯å½¢æ—¶é—´é‡Œï¼Œ \næˆ‘ä»¬å¥”è·‘ï¼Œé©»è¶³ï¼Œå¼ æœ›ã€‚ \nä¸æ—§æˆ‘æ“¦è‚©ï¼Œ \nç‰µèµ·æ˜å¤©çš„æ‰‹æŒã€‚ \nä¸”æ­Œä¸”è¡Œï¼Œå¾ªç€å¾®å…‰ã€‚ \nè°¢è°¢æ­¦æ±‰ï¼Œä¸€èµ·è¸è¿›æ–°çš„ä¸€å¹´ã€‚", 
        "0101": "æ–°å¹´~æ–°çš„æ—¥å…‰ï¼Œæ–°çš„å¸Œæœ›ã€‚ \næ„¿ä½ å¤©çœŸï¼Œå……æ»¡æƒ³è±¡ã€‚ \nå‹‡æ•¢å‡ºå‘ï¼Œä¿æŒå½¢çŠ¶ã€‚ \nè°¢è°¢æ­¦æ±‰ï¼ç»™æˆ‘ä»¬æ–°çš„åŠ›é‡~" 
    };
// --- ä¿®æ­£åçš„é¡ºåº ---
const eggIcons = Array.from({length: 8}, (_, i) => `images/æœå® (${i+1}).png`); // 1. å…ˆå®šä¹‰è·¯å¾„

const preloadedImages = []; // 2. å†è¿›è¡Œé¢„åŠ è½½
eggIcons.forEach(src => {
    const img = new Image();
    img.src = src;
    preloadedImages.push(img);
});

    const tourData = [
        { id: "0726", city: "åŒ—äº¬", time: "2025.07.26", part: 1, guest: "å˜‰å®¾ï¼šä»»è´¤é½", isSpecial: "ç”Ÿæ—¥åœº", personalPics: Array.from({length: 17}, (_, i) => `images/0726 (${i+1}).jpg`), guestPics: Array.from({length: 9}, (_, i) => `images/0726guest (${i+1}).jpg`), songs: [{n:"è¿‘æ¥å¯å¥½featä»»è´¤é½",t:"guest"},{n:"å¤©æ¶¯",t:"guest"},{n:"æˆ‘æ˜¯ä¸€åªé±¼",t:"guest"},{n:"å°‘å¹´æ—¶ä»£å¿ƒç›®ä¸­çš„è‹±é›„",t:"request"},{n:"é£æ¾",t:"request"},{n:"äº”è¨€",t:"surprise"},{n:"æ¯”å¦‚ä¸–ç•Œ",t:"surprise"},{n:"ä¸ƒæ¥¼",t:"surprise"}] },
        { id: "0727", city: "åŒ—äº¬", time: "2025.07.27", part: 1, guest: "å˜‰å®¾ï¼šæå®‡æ˜¥", personalPics: Array.from({length: 12}, (_, i) => `images/0727 (${i+1}).jpg`), guestPics: Array.from({length: 6}, (_, i) => `images/0727guest (${i+1}).jpg`), songs: [{n:"ç©ºç©ºfeatæå®‡æ˜¥",t:"guest"},{n:"å†¬æ³³",t:"guest"},{n:"æˆ‘ä»¬å­˜åœ¨ä¸€åˆ¹é‚£çš„å–œæ¬¢",t:"request"},{n:"â˜†",t:"request"},{n:"ä¸ƒæ¥¼",t:"surprise"},{n:"è¿œè¾°",t:"surprise"},{n:"äº”è¨€",t:"surprise"},{n:"çŸ¥æ´²",t:"surprise"}] },
        { id: "0808", city: "ä¸Šæµ·", time: "2025.08.08", part: 1, guest: "å˜‰å®¾ï¼šå¼ ä¿¡å“²", personalPics: Array.from({length: 12}, (_, i) => `images/0808 (${i+1}).jpg`), guestPics: Array.from({length: 6}, (_, i) => `images/0808guest (${i+1}).jpg`), songs: [{n:"æ¬èµ°featå¼ ä¿¡å“²",t:"guest"},{n:"åˆ«æ€•æˆ‘ä¼¤å¿ƒ",t:"guest"},{n:"æ— æ‰€æ±‚å¿…æ»¡è½½è€Œå½’",t:"request"},{n:"PONY",t:"request"}] },
        { id: "0809", city: "ä¸Šæµ·", time: "2025.08.09", part: 1, guest: "å˜‰å®¾ï¼šé­å¦‚è±", personalPics: Array.from({length: 9}, (_, i) => `images/0809 (${i+1}).jpg`), guestPics: Array.from({length: 4}, (_, i) => `images/0809guest (${i+1}).jpg`), songs: [{n:"å°åŠ feat é­å¦‚è±",t:"guest"},{n:"have a nice day",t:"guest"},{n:"ä¹”å¦çš„å¿ƒäº‹",t:"request"},{n:"è´ªå¾—",t:"request"},{n:"æ¯”å¦‚ä¸–ç•Œ",t:"surprise"}] },
        { id: "0920", city: "æ­å·", time: "2025.09.20", part: 1, guest: "å˜‰å®¾ï¼šè§æ•¬è…¾", personalPics: Array.from({length: 10}, (_, i) => `images/0920 (${i+1}).jpg`), guestPics: Array.from({length: 9}, (_, i) => `images/0920guest (${i+1}).jpg`), songs: [{n:"å¥‡å¦™èƒ½åŠ›æ­Œfeatè§æ•¬è…¾",t:"guest"},{n:"æ…¢æ…¢è›®æ»¡",t:"guest"},{n:"æµ·èŠ‹æ‹",t:"guest"},{n:"ç¡å§",t:"request"}] },
        { id: "0921", city: "æ­å·", time: "2025.09.21", part: 1, guest: "å˜‰å®¾ï¼šè«æ–‡è”š", personalPics: Array.from({length: 10}, (_, i) => `images/0921 (${i+1}).jpg`), guestPics: Array.from({length: 4}, (_, i) => `images/0921guest (${i+1}).jpg`), songs: [{n:"é˜´å¤©+èµ°é©¬featè«æ–‡è”š ",t:"guest"},{n:"å¯‚å¯çš„æ‹äººå•Š",t:"guest"},{n:"éš¾è§£é£æƒ…",t:"request"},{n:"æ—‹æœ¨",t:"request"}] },
        { id: "1018", city: "å—äº¬", time: "2025.10.18", part: 1, guest: "å˜‰å®¾ï¼šè®¸é’§", personalPics: Array.from({length: 11}, (_, i) => `images/1018 (${i+1}).jpg`), guestPics: Array.from({length: 9}, (_, i) => `images/1018guest (${i+1}).jpg`), songs: [{n:"æ³›çµfeatè®¸é’§",t:"guest"},{n:"çƒ‚æƒ…",t:"guest"},{n:"å‘¨æ¸¸",t:"request"},{n:"å¤ªç©º",t:"request"},{n:"æ¯”å¦‚ä¸–ç•Œ+é£æ¾(æ¸…å”±)",t:"surprise"}] },
        { id: "1101", city: "è¥¿å®‰", time: "2025.11.01", part: 1, guest: "å˜‰å®¾ï¼šå°šé›¯å©•", personalPics: Array.from({length: 10}, (_, i) => `images/1101 (${i+1}).jpg`), guestPics: Array.from({length: 7}, (_, i) => `images/1101guest (${i+1}).jpg`), songs: [{n:"äº¤å·featå°šé›¯å©•",t:"guest"},{n:"Atypicalå¼‚ç±»",t:"guest"},{n:"æç«¯è€…",t:"guest"},{n:"ä¸”æ…¢",t:"request"},{n:"æœ‰åˆ™æŠ±æŠ±æ— åˆ™ç¬‘ç¬‘",t:"request"},{n:"çŸ¥æ´²",t:"surprise"}] },
        { id: "1108", city: "æµå—", time: "2025.11.08", part: 1, guest: "å˜‰å®¾ï¼šéƒå¯å”¯", personalPics: Array.from({length: 9}, (_, i) => `images/1108 (${i+1}).jpg`), guestPics: Array.from({length: 6}, (_, i) => `images/1108guest (${i+1}).jpg`), songs: [{n:"è¿›åŒ–featéƒå¯å”¯",t:"guest"},{n:"è·¯è¿‡äººé—´",t:"guest"},{n:"ä»å¤´",t:"request"},{n:"è‡³å°‘è¿˜æœ‰ä½ ",t:"request"},{n:"çŸ¥æ´²",t:"surprise"},{n:"ä¸ƒæ¥¼",t:"surprise"}] },
        { id: "1115", city: "é‡åº†", time: "2025.11.15", part: 1, guest: "å˜‰å®¾ï¼šå¶è““", personalPics: Array.from({length: 9}, (_, i) => `images/1115 (${i+1}).jpg`), guestPics: Array.from({length: 6}, (_, i) => `images/1115guest (${i+1}).jpg`), songs: [{n:"çˆ±å®Œä¸å®Œfeatå¶è““",t:"guest"},{n:"è’²å…¬è‹±",t:"guest"},{n:"ç‰äººæ­Œ",t:"request"},{n:"æ€ªæƒ…æ­Œ",t:"request"},{n:"æ— çƒŸåŒº",t:"surprise"},{n:"çŸ¥æ´²",t:"surprise"}] },
        { id: "1129", city: "å¦é—¨", time: "2025.11.29", part: 1, guest: "ç‹¬å”±åœº", personalPics: Array.from({length: 9}, (_, i) => `images/1129 (${i+1}).jpg`), guestPics: [], songs: [{n:"å¤§è£‚ç¼",t:"request"},{n:"å’Œå¹³",t:"request"},{n:"æ²‰è¿·",t:"surprise"},{n:"ä¹±",t:"surprise"},{n:"é£æ¾",t:"surprise"},{n:"åœ¨æˆ‘çš„é“è·¯ä¸Š",t:"surprise"},{n:"çˆ±å®Œä¸å®Œ",t:"surprise"}] },
        { id: "1206", city: "æ·±åœ³", time: "2025.12.06", part: 1, guest: "å˜‰å®¾ï¼šGAI", personalPics: Array.from({length: 12}, (_, i) => `images/1206 (${i+1}).jpg`), guestPics: Array.from({length: 6}, (_, i) => `images/1206guest (${i+1}).jpg`), songs: [{n:"å†å†ä¸‡ä¹¡featGAI",t:"guest"},{n:"å…°èŠ±è‰",t:"guest"},{n:"å¤šå¤šç•™æ„",t:"request"},{n:"è¢«åŠ¨",t:"request"},{n:"éš¾è§£é£æƒ…",t:"surprise"},{n:"ä¹±",t:"surprise"}] },
        { id: "1207", city: "æ·±åœ³", time: "2025.12.07", part: 1, guest: "å˜‰å®¾ï¼šä¸‡å¦®è¾¾", personalPics: Array.from({length: 9}, (_, i) => `images/1207 (${i+1}).jpg`), guestPics: Array.from({length: 5}, (_, i) => `images/1207guest (${i+1}).jpg`), songs: [{n:"å’Œå¹³é¸½featä¸‡å¦®è¾¾",t:"guest"},{n:"ç®—äº†",t:"guest"},{n:"colorful world",t:"guest"},{n:"å››æµ·",t:"request"},{n:"æ³ªæ¡¥",t:"request"},{n:"æ²‰è¿·",t:"surprise"},{n:"ä¹±",t:"surprise"}] },
        { id: "1220", city: "è‹å·", time: "2025.12.20", part: 1, guest: "å˜‰å®¾ï¼šæ¨ä¹ƒæ–‡", personalPics: Array.from({length: 12}, (_, i) => `images/1220 (${i+1}).jpg`), guestPics: Array.from({length: 3}, (_, i) => `images/1220guest (${i+1}).jpg`), songs: [{n:"å…‰featæ¨ä¹ƒæ–‡",t:"guest"},{n:"æ˜Ÿæ˜Ÿå †æ»¡å¤©",t:"guest"},{n:"æ¸…é€",t:"request"},{n:"äººé—´",t:"request"},{n:"ä¹±",t:"surprise"},{n:"éš¾è§£é£æƒ…",t:"surprise"},{n:"çˆ±å®Œä¸å®Œ",t:"surprise"},{n:"çŸ¥æ´²",t:"surprise"}] },
        { id: "1231", city: "æ­¦æ±‰", time: "2025.12.31", part: 1, guest: "", isSpecial: "è·¨å¹´åœº", personalPics: Array.from({length: 11}, (_, i) => `images/1231 (${i+1}).jpg`), guestPics: [], songs: [{n:"äº²çˆ±çš„ä½ ",t:"request"},{n:"Best Better Ever",t:"request"},{n:"åº†ç¥",t:"request"},{n:"é“¶æ³°",t:"request"},{n:"ç‹¬è¡Œä¾ ",t:"request"},{n:"ä¹±",t:"surprise"},{n:"æ¯”å¦‚ä¸–ç•Œ",t:"surprise"},{n:"æµ·å¸‚èœƒæ¥¼",t:"surprise"}] },
        { id: "0101", city: "æ­¦æ±‰", time: "2026.01.01", part: 1, guest: "", isSpecial: "å…ƒæ—¦åœº", personalPics: Array.from({length: 12}, (_, i) => `images/0101 (${i+1}).jpg`), guestPics: [], songs: [{n:"æƒ…æ™¯å‰§",t:"request"},{n:"è¿œæ¸¸",t:"request"},{n:"ä¹å›­",t:"request"},{n:"My Dear Art",t:"request"},{n:"å†åº¦é‡ç›¸é€¢",t:"request"},{n:"ä¹±",t:"surprise"},{n:"å‰§çƒˆ",t:"surprise"}] },
        { id: "æˆéƒ½1", city: "æˆéƒ½", time: "2026.03.14", part: 2, status: "unplayed", guest: "", personalPics: [], guestPics: [], songs: [] },
        { id: "æˆéƒ½2", city: "æˆéƒ½", time: "2026.03.15", part: 2, status: "unplayed", guest: "", personalPics: [], guestPics: [], songs: [] },
        { id: "NB", city: "å®æ³¢", time: "coming soon", part: 2, status: "unplayed", guest: "", personalPics: [], guestPics: [], songs: [] },
        { id: "QD", city: "é’å²›", time: "coming soon", part: 2, status: "unplayed", guest: "", personalPics: [], guestPics: [], songs: [] },
        { id: "QZ", city: "æ³‰å·", time: "coming soon", part: 2, status: "unplayed", guest: "", personalPics: [], guestPics: [], songs: [] },
        { id: "HF", city: "åˆè‚¥", time: "coming soon", part: 2, status: "unplayed", guest: "", personalPics: [], guestPics: [], songs: [] },
        { id: "SY", city: "æ²ˆé˜³", time: "coming soon", part: 2, status: "unplayed", guest: "", personalPics: [], guestPics: [], songs: [] },
        { id: "ZZ", city: "éƒ‘å·", time: "coming soon", part: 2, status: "unplayed", guest: "", personalPics: [], guestPics: [], songs: [] }
    ];

// åŸå¸‚ç»çº¬åº¦åæ ‡åº“ï¼ˆç”¨äºè®¡ç®—ä¸¤åœ°è·ç¦»ï¼‰
const CITY_COORDS = {
    "åŒ—äº¬": [116.40, 39.90], "ä¸Šæµ·": [121.47, 31.23], "å¹¿å·": [113.26, 23.13],
    "æˆéƒ½": [104.06, 30.67], "æ·±åœ³": [114.05, 22.54], "æ­å·": [120.15, 30.28],
    "æ­¦æ±‰": [114.30, 30.58], "è¥¿å®‰": [108.93, 34.27], "å—äº¬": [118.79, 32.06],
    "é‡åº†": [106.55, 29.56], "å¦é—¨": [118.08, 24.47], "è‹å·": [120.58, 31.30],
    "æµå—": [117.00, 36.65], "å®æ³¢": [121.54, 29.86], "æ²ˆé˜³": [123.43, 41.80],
    "éƒ‘å·": [113.62, 34.74], "é’å²›": [120.38, 36.06], "æ³‰å·": [118.67, 24.87],
    "åˆè‚¥": [117.22, 31.82]
};

// è‡ªåŠ¨é‡Œç¨‹è®¡ç®—å‡½æ•° (Haversineç®—æ³•)
function calcTotalKM(list) {
    if (list.length < 2) return 0;
    let totalD = 0;
    const R = 6371; // åœ°çƒåŠå¾„
    for (let i = 0; i < list.length - 1; i++) {
        const p1 = CITY_COORDS[list[i].city];
        const p2 = CITY_COORDS[list[i+1].city];
        if (!p1 || !p2) continue;
        const dLat = (p2[1] - p1[1]) * Math.PI / 180;
        const dLon = (p2[0] - p1[0]) * Math.PI / 180;
        const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                  Math.cos(p1[1] * Math.PI / 180) * Math.cos(p2[1] * Math.PI / 180) * Math.sin(dLon/2) * Math.sin(dLon/2);
        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
        totalD += R * c;
    }
    return Math.round(totalD);
}

    const eggQuotes = ["â€œæ­Œæ‰‹å°é™ˆï¼Œçˆ±å–å¯ä¹ï¼Œçˆ±æ–©å¦–é™¤é­”â€", "â€œå­¤ç‹¬å‰å®³ï¼Œæˆ‘æ›´å‰å®³â€", "â€œä¸èµ¶ä»€ä¹ˆæµªæ½®ï¼Œä¹Ÿä¸æ­ä»€ä¹ˆèˆ¹ï¼Œæˆ‘è‡ªå·±æœ‰æµ·â€", "â€œåªè¦å¦³é¢å‘æˆ‘ï¼Œå¦³çš„å¸Œæœ›å°±éƒ½èƒ½å®ç°â€", "â€œHere I Stand,I'm Not Going Anywhereâ€", "â€œå¶å°”æ„¤æ€’ï¼Œå¶å°”å«‰å¦’ï¼Œä½ æ˜¯å¯çˆ±ç”Ÿç‰©â€", "â€œæŠšæ‘¸å¦³çš„éº»æœ¨ï¼Œäº²å»å¦³çš„çœ‰ç›®â€", "â€œå¿ƒæ€€å•®é›ªå¤§å¿—æ„¿ï¼â€"];

    // 2. æ ¸å¿ƒå‡½æ•°
    // æ›¿æ¢ç¬¬ 216 è¡Œèµ·çš„å‡½æ•°
function showQuote(id) {
    if (quotes[id]) { 
        // å°†åŸæ¥çš„ innerText æ”¹ä¸ºè°ƒç”¨æ‰“å­—æœº
        const target = document.getElementById('modalText');
        showModal();
        typewriter(target, quotes[id], 60); 
    }
}

// æ–°å¢é€šç”¨çš„æ˜¾ç¤ºå‡½æ•°ï¼Œç¡®ä¿åŠ¨ç”»ç”Ÿæ•ˆ
function showModal() {
    const modal = document.getElementById('quoteModal');
    modal.style.display = 'flex';
    void modal.offsetWidth; // å¼ºåˆ¶åˆ·æ–°æ¸²æŸ“ï¼Œç¡®ä¿åŠ¨ç”»è§¦å‘
    modal.classList.add('active');
    document.body.style.overflow = 'hidden'; // é”å®šèƒŒæ™¯æ»šåŠ¨
}

// æ›¿æ¢ç¬¬ 221 è¡Œèµ·çš„ closeModal
function closeModal() {
    const modal = document.getElementById('quoteModal');
    modal.classList.remove('active');
    setTimeout(() => {
        modal.style.display = 'none';
        document.body.style.overflow = 'auto'; // æ¢å¤æ»šåŠ¨
        // æ³¨æ„ï¼šå¦‚æœä½ æƒ³ä¿ç•™â€œæˆ‘åœ¨ç°åœºâ€çš„é’©å­ï¼Œä¸è¦åœ¨è¿™é‡Œé‡ç½® checkbox
    }, 300);
}

    function toggleMusic() {
        const music = document.getElementById('bgMusic');
        const icon = document.getElementById('musicIcon');
        const btn = document.getElementById('musicControl');
        if (music.paused) { music.volume = 0.3; music.play(); icon.innerText = 'ğŸµ'; btn.classList.add('rotating'); }
        else { music.pause(); icon.innerText = 'ğŸ”‡'; btn.classList.remove('rotating'); }
    }

    function changeBGM(newSrc) {
        const music = document.getElementById('bgMusic');
        const source = document.getElementById('musicSource');
        source.src = newSrc; music.load(); if (!music.paused) music.play();
    }

    function switchPics(id, type) {
        const container = document.getElementById(`slider-${id}`);
        const item = tourData.find(d => d.id === id);
        if (!item) return;
        const pics = type === 'guest' ? item.guestPics : item.personalPics;
        if (pics && pics.length > 0) {
            container.innerHTML = pics.map(src => `<img src="${src}" class="slider-img" loading="lazy">`).join('');
        }
    }

    let currentPart = 1;
    function changePart(part, btn) {
    currentPart = part;
    // åˆ‡æ¢æŒ‰é’®é«˜äº®çŠ¶æ€
    document.querySelectorAll('.part-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');

    // --- èƒŒæ™¯åˆ‡æ¢æ ¸å¿ƒé€»è¾‘ ---
    if (part === 3) {
        // â€œæˆ‘çš„ä¸€ç²’â€æ¿å—ä¸“å±èƒŒæ™¯ï¼šä½¿ç”¨æµ…è‰²æ¸å˜å åŠ ä¸€å¼ ç‰¹å®šçš„èƒŒæ™¯å›¾
        // ä½ å¯ä»¥å°† 'images/my_grain_bg.jpg' æ¢æˆä½ å‡†å¤‡å¥½çš„æ¨±æ¡ƒæˆ–å…¶ä»–ä¸»é¢˜å›¾ç‰‡è·¯å¾„
        document.body.style.backgroundImage = "linear-gradient(to bottom, rgba(255,255,255,0.8), rgba(255,255,255,0.6)), url('images/my_grain_bg.jpg')";
        document.body.style.backgroundSize = "cover"; // ç¡®ä¿èƒŒæ™¯é“ºæ»¡
    } else {
        // è¿˜åŸ PART I å’Œ PART II çš„å·¡æ¼”ä¸»èƒŒæ™¯
        document.body.style.backgroundImage = "linear-gradient(to bottom, rgba(255,255,255,0.7) 0%, rgba(255,255,255,0.2) 25%, transparent 40%), url('images/033de8f0d6622db97e42ea88b4770bba.jpg')";
        document.body.style.backgroundSize = "100% auto";
    }

    render(); 
    window.scrollTo({ top: 400, behavior: 'smooth' });
}

function saveCheckState(id, isChecked) {
    // 1. å°†å‹¾é€‰çŠ¶æ€å­˜å…¥æœ¬åœ°å­˜å‚¨ï¼Œç¡®ä¿åˆ·æ–°ä¸ä¸¢å¤±
    localStorage.setItem('checked_' + id, isChecked);
    
    // 2. å¦‚æœæ˜¯å‹¾é€‰åŠ¨ä½œï¼Œè§¦å‘åŸæœ‰çš„è¯­å½•å¼¹çª—
    if (isChecked) {
        showQuote(id);
    }
    
    // 3. å¦‚æœå½“å‰å¤„äºâ€œæˆ‘çš„ä¸€ç²’â€æ¿å—ï¼Œç«‹å³åˆ·æ–°é¡µé¢æ˜¾ç¤ºæœ€æ–°ç»Ÿè®¡
    if (currentPart === 3) {
        render();
    }
}

function renderMyGrain(container) {
    // 1. åŸºç¡€æ•°æ®å‡†å¤‡
    const allPlayedTours = tourData.filter(item => item.status !== 'unplayed');
    const myTours = tourData.filter(item => localStorage.getItem('checked_' + item.id) === 'true');
    const sortedTours = [...myTours].sort((a, b) => new Date(a.time.replace(/\./g, '/')) - new Date(b.time.replace(/\./g, '/')));
    
    const myCount = myTours.length;
    const totalPlayedCount = allPlayedTours.length;
    const ratio = totalPlayedCount > 0 ? myCount / totalPlayedCount : 0;
    
    // è®¡ç®—æ€»é‡Œç¨‹
    const totalKM = calcTotalKM(sortedTours);

    // 2. å‹‹ç« å¢™æ¨¡å— (ä¿æŒåŸæœ‰é€»è¾‘)
    const badgeWall = document.createElement('div');
    badgeWall.style.cssText = "width: 100%; max-width: 600px; margin: 0 auto 30px; background: #fff; border: 1px solid #ddd; padding: 25px 15px; text-align: center;";

    const badges = [
        { name: "å¥‡å¦™èƒ½åŠ›", icon: "ğŸŒ±", unlocked: myCount > 0 },
        { name: "å†å†ä¸‡ä¹¡", icon: "ğŸ’", unlocked: ratio > 0.3 },
        { name: "ä¸–ç•Œæ­£ä¸­", icon: "ğŸ", unlocked: ratio > 0.7 },
        { name: "å…¨å‹¤ä¹‹çº¦", icon: "ğŸŒ²", unlocked: ratio === 1 && totalPlayedCount > 0 }
    ];

    let badgesHTML = `<p style="font-size: 0.8em; color: #999; letter-spacing: 3px; margin-bottom: 20px;">ä¸€ç²’ Â· è£èª‰å‹‹ç« å¢™</p>
                      <div style="display: flex; justify-content: space-around; align-items: flex-start;">`;
    badges.forEach(b => {
        const glowClass = b.unlocked ? 'badge-unlocked' : '';
        badgesHTML += `
            <div style="flex: 1; opacity: ${b.unlocked ? '1' : '0.15'}; filter: ${b.unlocked ? 'none' : 'grayscale(1)'}; transition: all 0.6s;">
                <div class="${glowClass}" style="font-size: 24px; width: 50px; height: 50px; line-height: 50px; border: 2px solid #eee; border-radius: 50%; margin: 0 auto; background: #fdfdfd; display: flex; align-items: center; justify-content: center;">
                    ${b.icon}
                </div>
                <div style="font-size: 11px; margin-top: 8px; font-weight: bold; color: ${b.unlocked ? '#333' : '#bbb'}">${b.name}</div>
            </div>`;
    });
    badgesHTML += `</div>`;
    badgeWall.innerHTML = badgesHTML;
    container.appendChild(badgeWall);

    // 3. è®°å¿†å­˜æ ¹æ¨¡å— (é›†æˆé‡Œç¨‹è®¡ç®—)
    const uniqueCities = [...new Set(myTours.map(item => item.city))].length;
    const myCard = document.createElement('div');
    myCard.className = 'tour-card ticket-card';
    myCard.style.cssText = "width: 100%; max-width: 500px; margin: 0 auto; text-align: center;";
    
    myCard.innerHTML = `
        <div class="special-badge" style="right: 15px; top: -10px;">ç¼–å·: 0726</div>
        <div style="font-size: 0.7em; color: #999; letter-spacing: 5px; margin-bottom: 5px;">LIVE TOUR MEMORY</div>
        <h2 style="letter-spacing:10px; color: #333; margin: 10px 0; border-bottom: 1px solid #eee; padding-bottom: 15px;">ä¸€ç²’ Â· å­˜æ ¹</h2>
        
        <div style="display: flex; justify-content: space-around; padding: 20px 0;">
            <div style="border-right: 1px dashed #ddd; flex: 1;">
                <div style="font-size: 2.2em; font-family: 'Times New Roman'; color: var(--tag-special);">${myCount}</div>
                <div style="font-size: 0.7em; color: #999;">ç´¯è®¡åœºæ¬¡ / SHOWS</div>
            </div>
            <div style="flex: 1;">
                <div style="font-size: 2.2em; font-family: 'Times New Roman'; color: var(--tag-special);">${uniqueCities}</div>
                <div style="font-size: 0.7em; color: #999;">åŸå¸‚è¶³è¿¹ / CITIES</div>
            </div>
        </div>

        <div style="text-align: left; padding: 18px; margin: 10px 0; border: 1px dashed #ccc; border-radius: 4px; font-size: 0.85em; background: #fafafa; line-height: 1.8;">
            ${myCount > 0 ? `
                <div>âœ¨ <b style="color:#555">åˆæ¬¡ç›¸é‡:</b> <span style="color:#888">${sortedTours[0].time} Â· ${sortedTours[0].city}</span></div>
                <div style="margin-top: 5px;">ğŸ“ <b style="color:#555">æ¼«æ¸¸è½¨è¿¹:</b> <span style="color:#888">${[...new Set(sortedTours.map(t => t.city))].join(' â†’ ')}</span></div>
                <div style="margin-top: 5px; border-top: 1px solid #eee; padding-top: 5px;">âœˆï¸ <b style="color:#555">ç´¯è®¡é‡Œç¨‹:</b> <span style="color:var(--tag-special); font-weight:bold; font-family:'Times New Roman'; font-size:1.1em;">${totalKM.toLocaleString()}</span> <span style="color:#999; font-size:0.8em;">KM</span></div>
            ` : `<p style="text-align:center; color: #ccc;">è¿˜æ²¡æœ‰ç•™ä¸‹å±äºå¦³çš„å­˜æ ¹</p>`}
        </div>

        ${myCount > 0 ? `<div class="seal-stamp">COLLECTED<br>MEMORIES</div>` : ''}
        <p style="margin-top: 25px; font-size: 0.75em; color: #bbb; font-style: italic;">â€œ ä½ å»ï¼Œæˆ‘ç­‰ï¼Œä¸ç­ â€</p>
    `;
    container.appendChild(myCard);
}


    function render() {
        const grid = document.getElementById('mainGrid');
        if(!grid) return; grid.innerHTML = '';

        if (currentPart === 3) {
        renderMyGrain(grid);
        return;
    }
        
        const filteredData = tourData.filter(item => item.part === currentPart);
        filteredData.forEach(item => {
            const card = document.createElement('div');
            card.className = `tour-card ${item.status === 'unplayed' ? 'unplayed' : ''}`;
            const badgeHTML = item.isSpecial ? `<div class="special-badge">${item.isSpecial}</div>` : '';
            const unplayedHTML = item.status === 'unplayed' ? `<span class="unplayed-label">(å·²å®˜å®£Â·æœªå¼€æ¼”)</span>` : '';
            const tags = item.songs.map(s => `<span class="song-tag ${s.t}">${s.n}</span>`).join('');
            card.innerHTML = `
    ${badgeHTML} 
    <div class="tour-info">
       <span class="tour-date">
           <span class="city-name" onclick="switchPics('${item.id}', 'personal')">${item.city}</span> 
           <span class="date-num">${item.time}</span>
           ${unplayedHTML}
       </span>
       <span class="tour-guest" onclick="switchPics('${item.id}', 'guest')">${item.guest}</span>
    </div>
    ${item.personalPics.length > 0 ? `
        <div class="image-slider" id="slider-${item.id}">
            ${item.personalPics.map(src => `<img src="${src}" class="slider-img" loading="lazy">`).join('')}
        </div>` : '<div style="height:20px"></div>'}
    <div class="special-songs-box">${tags}</div>
    
    <div class="check-area">
        <label style="cursor: pointer;">
            <input type="checkbox" 
                   ${localStorage.getItem('checked_' + item.id) === 'true' ? 'checked' : ''} 
                   onchange="saveCheckState('${item.id}', this.checked)"> 
            æˆ‘åœ¨ç°åœº
        </label>
    </div>`;
            grid.appendChild(card);
        });

     // --- ä¿®æ­£åçš„éšæœºæ’’æœå®é€»è¾‘ ---
for(let i=0; i<10; i++) {
    const egg = document.createElement('img');
    egg.className = 'shiguan-egg';
    egg.src = eggIcons[i%8];

    // é€»è¾‘ï¼šå°†é¡µé¢å®½åº¦åˆ†ä¸ºå·¦å³ä¸¤éƒ¨åˆ†
    // ä¸€åŠæ¦‚ç‡å‡ºç°åœ¨å·¦ä¾§ (2% åˆ° 15% å¤„)
    // ä¸€åŠæ¦‚ç‡å‡ºç°åœ¨å³ä¾§ (85% åˆ° 98% å¤„)
    const isLeft = Math.random() > 0.5;
    if (isLeft) {
        egg.style.left = (Math.random() * 13 + 2) + "%"; 
    } else {
        egg.style.left = (Math.random() * 13 + 85) + "%"; 
    }
    
    egg.style.top = (Math.random() * 90) + "%";
    egg.style.animationDelay = (Math.random() * 2) + "s";

    // ç‚¹å‡»äº‹ä»¶ä¿æŒä¸å˜
   // æ‰¾åˆ° render() é‡Œçš„ egg.onclick é€»è¾‘è¿›è¡Œæ›¿æ¢
egg.onclick = function(e) {
    e.stopPropagation();
    
    // 1. ç›´æ¥ç§»é™¤æœå®ï¼Œä¸è¿›è¡Œæ”¶ç¼©åŠ¨ç”»
    this.remove(); 

    // 2. å‡†å¤‡è¯­å½•å†…å®¹
    const randomQuote = eggQuotes[Math.floor(Math.random() * eggQuotes.length)];
    document.getElementById('modalText').innerHTML = `
        <div style="text-align:left; color:var(--tag-guest); margin-bottom:15px; font-weight:bold;">ğŸæ¡åˆ°ä¸€ç²’æœå®ğŸ</div>
        <div style="font-style:italic; text-align:left;">${randomQuote}</div>`;
    
    // 3. è°ƒç”¨ä¹‹å‰å®šä¹‰çš„ showModal å‡½æ•°ï¼ˆå…³é”®ï¼šè¿™ä¼šæ·»åŠ  .active ç±»åï¼Œè®©å¼¹çª—æ˜¾ç¤ºï¼‰
    showModal();
};
    
    grid.appendChild(egg);

     }
}

function typewriter(element, text, speed = 50) {
    element.innerText = '';
    let i = 0;
    const timer = setInterval(() => {
        if (i < text.length) {
            element.innerText += text.charAt(i);
            i++;
        } else {
            clearInterval(timer);
        }
    }, speed);
}




    window.onload = render;
</script>
<script>
(function() {
    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d');
    canvas.style.position = 'fixed';
    canvas.style.top = '0';
    canvas.style.left = '0';
    canvas.style.pointerEvents = 'none'; 
    canvas.style.zIndex = '10000';
    document.body.appendChild(canvas);

    let particles = [];

    function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resize);
    resize();

    class Ribbon {
        constructor(x, y) {
            this.x = x;
            this.y = y;
            const colors = ['#FFD700', '#1E90FF', '#FFDF00', '#87CEFA']; 
            this.color = colors[Math.floor(Math.random() * colors.length)];
            this.w = Math.random() * 10 + 6;
            this.h = Math.random() * 4 + 2;
            this.vx = Math.random() * 10 - 5;
            this.vy = Math.random() * -15 - 5; 
            this.gravity = 0.3;
            this.rotation = Math.random() * 360;
            this.rSpeed = Math.random() * 10 - 5;
            this.alpha = 1;
        }
        update() {
            this.vy += this.gravity;
            this.x += this.vx;
            this.y += this.vy;
            this.rotation += this.rSpeed;
            this.alpha -= 0.008; 
        }
        draw() {
            ctx.save();
            ctx.translate(this.x, this.y);
            ctx.rotate(this.rotation * Math.PI / 180);
            ctx.globalAlpha = this.alpha;
            ctx.fillStyle = this.color;
            ctx.fillRect(-this.w/2, -this.h/2, this.w, this.h); 
            ctx.restore();
        }
    }

    // --- ä¿®æ”¹åçš„æ ¸å¿ƒé€»è¾‘ ---
    window.addEventListener('click', function(e) {
        // 1. åˆ¤æ–­ç‚¹å‡»çš„æ˜¯å¦ä¸º checkbox
        // 2. å¢åŠ åˆ¤æ–­æ¡ä»¶ï¼šåªæœ‰ e.target.checked ä¸º trueï¼ˆç‚¹äº®ï¼‰æ—¶æ‰æ‰§è¡Œ
        if (e.target.type === 'checkbox' && e.target.checked) {
            const count = 100; 
            for (let i = 0; i < count; i++) {
                particles.push(new Ribbon(e.clientX, e.clientY));
            }
        }
    });

    function animate() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        particles = particles.filter(p => p.alpha > 0 && p.y < canvas.height);
        particles.forEach(p => { 
            p.update(); 
            p.draw(); 
        });
        requestAnimationFrame(animate);
    }
    animate();
})();
</script>
</body>
</html>